<!doctype html>
<html>
	<head>
		<title>Le mot le plus long</title>
		<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		<style>
			html {
				text-align: center;
			}
			input {
				font-size: 26px;
				margin: 1em;
			}
			input.loading {
				padding-right: 16px;
				background-image: url("loading.gif");
				background-repeat: no-repeat;
				background-position: right;
			}
			output {
				display: inline-block;
			}
			output > ul {
				display: inline-block;
				vertical-align: top;
				margin: 0em 1em;
			}
		</style>
	</head>
	<body>
		<h1>Le mot le plus long</h1>
		<input type="text"><br/>
		<output>
		<script>
			var currentCancellable = {cancelled: true};
			var displayResults = function(results) {
				$('output').empty();
				var currentLength = {
					length: Number.MAX_VALUE,
					span: null
				};
				for(var i=0;i<results.length;i++) {
					var result = results[i];
					if (result.length < currentLength.length) {
						currentLength = {
							length: result.length,
							span: $('<ul/>').appendTo('output')
							};
					}
					currentLength.span.append('<li>'+result+'</li>');
				}
			};
			$('input').keydown(function() {
				/*var request = $.ajax({
					url: 'query',
					data: {letters: $(this).val()},
					dataType: 'json'
				});*/
				var request = $.Deferred(function(dfd){setTimeout(function(){dfd.resolve(["obelix", "asterix", "velo", "toi", "moi"]);}, 1000);});
				var newCancellable = {cancelled: false};
				currentCancellable.cancelled = true;
				currentCancellable = newCancellable;
				$('input').addClass('loading');
				request.done(function(result) {
					if (!newCancellable.cancelled) {
						displayResults(result);
						$('input').removeClass('loading');
					}
				});
			});
		</script>
	</body>
</html>

